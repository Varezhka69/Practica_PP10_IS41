<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–ê–û "–°–±–µ—Ä–±–∞–Ω–∫" - –£—á—ë—Ç –∑–∞–π–º–æ–≤ –∏ –≤–∫–ª–∞–¥–æ–≤</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background-color: #f0f0f0;
            padding: 20px;
            line-height: 1.4;
            min-height: 100vh;
            background-image: linear-gradient(90deg, transparent 99px, #e0e0e0 99px, #e0e0e0 101px, transparent 101px), linear-gradient(#eee .1em, transparent .1em);
            background-size: 100% 1.2em;
        }

        .terminal {
            width: 95%;
            max-width: 1400px;
            margin: 20px auto;
            border: 3px double #000000;
            background: #ffffff;
            position: relative;
            box-shadow: 5px 5px 15px rgba(0,0,0,0.2);
        }

        .terminal-header {
            background: linear-gradient(to right, #0033a0, #0055cc);
            color: #ffffff;
            padding: 20px;
            border-bottom: 3px double #000000;
            text-align: center;
            position: relative;
        }

            .terminal-header h1 {
                font-size: 24px;
                font-weight: bold;
                margin: 0;
                text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
                letter-spacing: 1px;
            }

            .terminal-header h2 {
                font-size: 18px;
                margin-top: 10px;
                opacity: 0.9;
                font-weight: normal;
            }

        .terminal-menu {
            display: flex;
            background: #e8e8e8;
            padding: 15px;
            border-bottom: 2px solid #000000;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

            .terminal-menu button {
                padding: 12px 24px;
                background: #0033a0;
                color: white;
                border: 3px outset #000000;
                cursor: pointer;
                font-family: 'Courier New', monospace;
                font-weight: bold;
                font-size: 16px;
                min-width: 160px;
                transition: all 0.2s;
                flex: 1;
                max-width: 200px;
            }

                .terminal-menu button:hover {
                    background: #002080;
                    border-style: inset;
                    transform: translateY(1px);
                }

        .terminal-content {
            padding: 30px;
            min-height: 500px;
        }

        .ascii-block {
            border: 2px solid #000000;
            padding: 25px;
            margin: 0 auto;
            background: #f8f8f8;
            position: relative;
            width: 100%;
            box-sizing: border-box;
            overflow: hidden;
        }

        .corner {
            position: absolute;
            font-size: 18px;
            line-height: 1;
            color: #000000;
        }

        .corner-tl {
            top: -2px;
            left: -2px;
        }

        .corner-tr {
            top: -2px;
            right: -2px;
        }

        .corner-bl {
            bottom: -2px;
            left: -2px;
        }

        .corner-br {
            bottom: -2px;
            right: -2px;
        }

        .form-group {
            margin-bottom: 20px;
        }

            .form-group label {
                display: block;
                margin-bottom: 8px;
                font-weight: bold;
                color: #333333;
            }

        .terminal-input {
            width: 100%;
            padding: 12px;
            border: 2px inset #000000;
            background: #ffffff;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            box-sizing: border-box;
        }

            .terminal-input:focus {
                outline: none;
                border: 2px inset #0033a0;
                background: #f0f8ff;
            }

        .terminal-btn {
            padding: 15px 30px;
            background: #0033a0;
            color: white;
            border: 3px outset #000000;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            font-size: 18px;
            width: 100%;
            margin-top: 15px;
            transition: all 0.2s;
        }

            .terminal-btn:hover {
                background: #002080;
                border-style: inset;
            }

            .terminal-btn:active {
                transform: translateY(2px);
            }

            .terminal-btn:disabled {
                background: #666666;
                cursor: not-allowed;
                border-style: outset;
            }

        .terminal-message {
            padding: 15px;
            margin: 15px 0;
            border: 2px solid #000000;
            font-weight: bold;
            display: none;
            white-space: pre-line;
            box-sizing: border-box;
        }

        .message-success {
            background: #e8ffe8;
            border-color: #008800;
            color: #006600;
        }

        .message-error {
            background: #ffe8e8;
            border-color: #880000;
            color: #660000;
        }

        .message-info {
            background: #e8f0ff;
            border-color: #0033a0;
            color: #0033a0;
        }

        .terminal-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            border: 2px solid #000000;
            table-layout: fixed;
            box-sizing: border-box;
        }

            .terminal-table th {
                background: #0033a0;
                color: white;
                padding: 15px 10px;
                text-align: left;
                border: 1px solid #000000;
                font-weight: bold;
                font-size: 14px;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }

            .terminal-table td {
                padding: 12px 10px;
                border: 1px solid #000000;
                background: #ffffff;
                font-size: 14px;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }

            .terminal-table.loans-table th:nth-child(1), .terminal-table.loans-table td:nth-child(1) {
                width: 12%;
            }
            .terminal-table.loans-table th:nth-child(2), .terminal-table.loans-table td:nth-child(2) {
                width: 12%;
            }
            .terminal-table.loans-table th:nth-child(3), .terminal-table.loans-table td:nth-child(3) {
                width: 8%;
            }
            .terminal-table.loans-table th:nth-child(4), .terminal-table.loans-table td:nth-child(4) {
                width: 8%;
            }
            .terminal-table.loans-table th:nth-child(5), .terminal-table.loans-table td:nth-child(5) {
                width: 15%;
            }
            .terminal-table.loans-table th:nth-child(6), .terminal-table.loans-table td:nth-child(6) {
                width: 15%;
            }
            .terminal-table.loans-table th:nth-child(7), .terminal-table.loans-table td:nth-child(7) {
                width: 10%;
            }
            .terminal-table.loans-table th:nth-child(8), .terminal-table.loans-table td:nth-child(8) {
                width: 15%;
            }
            .terminal-table.deposits-table th:nth-child(1), .terminal-table.deposits-table td:nth-child(1) {
                width: 15%;
            }
            .terminal-table.deposits-table th:nth-child(2), .terminal-table.deposits-table td:nth-child(2) {
                width: 12%;
            }
            .terminal-table.deposits-table th:nth-child(3), .terminal-table.deposits-table td:nth-child(3) {
                width: 10%;
            }
            .terminal-table.deposits-table th:nth-child(4), .terminal-table.deposits-table td:nth-child(4) {
                width: 12%;
            }
            .terminal-table.deposits-table th:nth-child(5), .terminal-table.deposits-table td:nth-child(5) {
                width: 15%;
            }
            .terminal-table.deposits-table th:nth-child(6), .terminal-table.deposits-table td:nth-child(6) {
                width: 10%;
            }
            .terminal-table.deposits-table th:nth-child(7), .terminal-table.deposits-table td:nth-child(7) {
                width: 16%;
            }
            .terminal-table.users-table th:nth-child(1), .terminal-table.users-table td:nth-child(1) {
                width: 10%;
            }
            .terminal-table.users-table th:nth-child(2), .terminal-table.users-table td:nth-child(2) {
                width: 25%;
            }
            .terminal-table.users-table th:nth-child(3), .terminal-table.users-table td:nth-child(3) {
                width: 20%;
            }
            .terminal-table.users-table th:nth-child(4), .terminal-table.users-table td:nth-child(4) {
                width: 15%;
            }
            .terminal-table.users-table th:nth-child(5), .terminal-table.users-table td:nth-child(5) {
                width: 15%;
            }
            .terminal-table.users-table th:nth-child(6), .terminal-table.users-table td:nth-child(6) {
                width: 15%;
            }
            .terminal-table tr:nth-child(even) td {
                background: #f0f0f0;
            }

            .terminal-table tr:hover td {
                background: #e0f0ff;
            }

        .table-container {
            width: 100%;
            overflow-x: auto;
            margin-top: 20px;
            border: 1px solid #ddd;
        }

        .operation {
            border: 1px solid #000000;
            padding: 15px;
            margin-bottom: 10px;
            background: #ffffff;
            position: relative;
            padding-left: 25px;
        }

            .operation:before {
                content: "‚îÇ ";
                position: absolute;
                left: 8px;
                top: 0;
                bottom: 0;
                color: #0033a0;
                font-weight: bold;
            }

        .operation-date {
            color: #0033a0;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .operation-amount {
            font-size: 16px;
            font-weight: bold;
            color: #006600;
        }

        .status {
            padding: 6px 12px;
            border-radius: 3px;
            font-weight: bold;
            display: inline-block;
            border: 1px solid;
            font-size: 12px;
        }

        .status-active {
            background: #e8ffe8;
            color: #006600;
            border-color: #008800;
        }

        .status-paid {
            background: #e8f0ff;
            color: #0033a0;
            border-color: #0033a0;
        }

        .status-overdue {
            background: #ffe8e8;
            color: #880000;
            border-color: #880000;
        }

        .status-admin {
            background: #ffd700;
            color: #8b4513;
            border-color: #ff8c00;
        }

        .hidden {
            display: none !important;
        }

        .terminal-footer {
            padding: 15px;
            background: #e8e8e8;
            border-top: 2px solid #000000;
            text-align: center;
            font-size: 14px;
            color: #666666;
        }

        @media (max-width: 1200px) {
            .terminal {
                width: 98%;
            }

            .terminal-menu button {
                min-width: 140px;
                padding: 10px 15px;
                font-size: 14px;
            }

            .terminal-content {
                padding: 20px;
            }
        }

        @media (max-width: 768px) {
            .terminal {
                width: 100%;
                margin: 10px 0;
            }

            .terminal-menu {
                flex-direction: column;
                align-items: center;
            }

                .terminal-menu button {
                    width: 90%;
                    max-width: 300px;
                    margin-bottom: 5px;
                }

            .terminal-content {
                padding: 15px;
            }

            .ascii-block {
                padding: 15px;
            }

            .table-container {
                font-size: 12px;
            }

            .terminal-table th,
            .terminal-table td {
                padding: 8px 5px;
                font-size: 12px;
            }
        }
        .ascii-art {
            font-family: monospace;
            white-space: pre;
            background: #f8f8f8;
            padding: 10px;
            border: 1px solid #ddd;
            margin: 10px 0;
            font-size: 12px;
            line-height: 1.2;
        }

        .loading {
            text-align: center;
            padding: 30px;
            color: #666;
            font-size: 16px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 25px 0;
        }

        .stat-card {
            border: 1px solid #000000;
            padding: 20px;
            text-align: center;
            background: #f8f8f8;
            min-height: 150px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .stat-value {
            font-size: 28px;
            font-weight: bold;
            margin: 10px 0;
        }

        .stat-label {
            font-size: 14px;
            color: #666666;
        }

        .amount-positive {
            color: #006600;
        }

        .amount-negative {
            color: #aa0000;
        }

        .amount-neutral {
            color: #0033a0;
        }

        .add-loan-btn {
            padding: 12px 24px;
            background: #1a9c29;
            color: white;
            border: 3px outset #000000;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 20px;
            display: inline-block;
            transition: all 0.2s;
        }

            .add-loan-btn:hover {
                background: #168822;
                border-style: inset;
            }

        .admin-btn {
            padding: 12px 24px;
            background: #ff8c00;
            color: white;
            border: 3px outset #000000;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 20px;
            display: inline-block;
            transition: all 0.2s;
            margin-left: 10px;
        }

            .admin-btn:hover {
                background: #e67e00;
                border-style: inset;
            }

        .summary {
            background: #f0f0f0;
            padding: 15px;
            border: 1px solid #000;
            margin-top: 20px;
            font-size: 16px;
        }

            .summary strong {
                color: #0033a0;
            }

        .admin-stats {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
            flex-wrap: wrap;
            gap: 15px;
        }

        .admin-stat-item {
            flex: 1;
            min-width: 200px;
            padding: 15px;
            border: 2px solid #0033a0;
            background: #f0f8ff;
            text-align: center;
        }

        .admin-stat-label {
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
        }

        .admin-stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #0033a0;
        }
    </style>
</head>
<body>

    <div id="authSection">
        <div class="terminal">
            <!-- ASCII —É–≥–ª—ã -->
            <div class="corner corner-tl">‚îå</div>
            <div class="corner corner-tr">‚îê</div>
            <div class="corner corner-bl">‚îî</div>
            <div class="corner corner-br">‚îò</div>

            <div class="terminal-header">
                <h1>‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</h1>
                <h1>‚îÇ  –ü–ê–û "–°–±–µ—Ä–±–∞–Ω–∫" - –°–∏—Å—Ç–µ–º–∞ —É—á—ë—Ç–∞ –∑–∞–π–º–æ–≤ –∏ –≤–∫–ª–∞–¥–æ–≤  ‚îÇ</h1>
                <h1>‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</h1>
            </div>

            <div class="terminal-menu">
                <button onclick="showLogin()" id="loginTabBtn">–í—Ö–æ–¥</button>
                <button onclick="showRegister()" id="registerTabBtn">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
            </div>

            <div class="terminal-content">
                <div id="loginForm" class="ascii-block">
                    <div class="corner corner-tl">‚îå</div>
                    <div class="corner corner-tr">‚îê</div>
                    <div class="corner corner-bl">‚îî</div>
                    <div class="corner corner-br">‚îò</div>

                    <h3 style="text-align: center; margin-bottom: 20px; color: #0033a0; font-size: 20px;">–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h3>

                    <div class="form-group">
                        <label>–õ–æ–≥–∏–Ω:</label>
                        <input type="text" id="loginUsername" class="terminal-input" placeholder="admin" value="admin">
                    </div>

                    <div class="form-group">
                        <label>–ü–∞—Ä–æ–ª—å:</label>
                        <input type="password" id="loginPassword" class="terminal-input" placeholder="admin123" value="admin123">
                    </div>

                    <button class="terminal-btn" onclick="login()" id="loginBtn">
                        –í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É
                    </button>

                    <div id="loginMessage" class="terminal-message"></div>

                    <div style="margin-top: 15px; font-size: 14px; color: #666; text-align: center;">
                        –î–ª—è —Ç–µ—Å—Ç–∞: admin / admin123
                    </div>
                </div>

                <div id="registerForm" class="ascii-block hidden">
                    <div class="corner corner-tl">‚îå</div>
                    <div class="corner corner-tr">‚îê</div>
                    <div class="corner corner-bl">‚îî</div>
                    <div class="corner corner-br">‚îò</div>

                    <h3 style="text-align: center; margin-bottom: 20px; color: #0033a0; font-size: 20px;">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h3>

                    <div class="form-group">
                        <label>–§–ò–û:</label>
                        <input type="text" id="regFullName" class="terminal-input" placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á">
                    </div>

                    <div class="form-group">
                        <label>–õ–æ–≥–∏–Ω:</label>
                        <input type="text" id="regUsername" class="terminal-input" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ª–æ–≥–∏–Ω">
                    </div>

                    <div class="form-group">
                        <label>–ü–∞—Ä–æ–ª—å:</label>
                        <input type="password" id="regPassword" class="terminal-input" placeholder="–ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤">
                    </div>

                    <button class="terminal-btn" onclick="register()" id="registerBtn">
                        –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
                    </button>

                    <div id="registerMessage" class="terminal-message"></div>
                </div>
            </div>

            <div class="terminal-footer">
                ¬© 2024 –ü–ê–û "–°–±–µ—Ä–±–∞–Ω–∫". –ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–π —Ü–µ–Ω—Ç—Ä: 8-800-555-55-50
            </div>
        </div>
    </div>

    <div id="mainApp" class="hidden">
        <div class="terminal">
            <!-- ASCII —É–≥–ª—ã -->
            <div class="corner corner-tl">‚îå</div>
            <div class="corner corner-tr">‚îê</div>
            <div class="corner corner-bl">‚îî</div>
            <div class="corner corner-br">‚îò</div>

            <div class="terminal-header">
                <h1>‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</h1>
                <h1>‚îÇ  –ü–ê–û "–°–±–µ—Ä–±–∞–Ω–∫" - –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç              ‚îÇ</h1>
                <h1>‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</h1>
                <div id="userWelcome" style="margin-top: 15px; font-size: 18px;">
                    –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, <span id="userName">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</span>!
                </div>
            </div>

            <div class="terminal-menu">
                <button onclick="showDashboard()" id="dashboardBtn">üè† –ì–ª–∞–≤–Ω–∞—è</button>
                <button onclick="showMyLoans()" id="loansBtn">üí≥ –ú–æ–∏ –∫—Ä–µ–¥–∏—Ç—ã</button>
                <button onclick="showMyDeposits()" id="depositsBtn">üè¶ –ú–æ–∏ –≤–∫–ª–∞–¥—ã</button>
                <button onclick="showNewLoan()" id="newLoanBtn">‚ûï –û—Ñ–æ—Ä–º–∏—Ç—å –∫—Ä–µ–¥–∏—Ç</button>
                <button onclick="showNewDeposit()" id="newDepositBtn">üí∞ –û—Ç–∫—Ä—ã—Ç—å –≤–∫–ª–∞–¥</button>
                <!-- –ê–¥–º–∏–Ω—Å–∫–∏–µ –∫–Ω–æ–ø–∫–∏ (–ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—É) -->
                <button onclick="showAllLoans()" id="allLoansBtn" class="hidden">üìã –í—Å–µ –∫—Ä–µ–¥–∏—Ç—ã</button>
                <button onclick="showAllDeposits()" id="allDepositsBtn" class="hidden">üìä –í—Å–µ –≤–∫–ª–∞–¥—ã</button>
                <button onclick="showAllUsers()" id="allUsersBtn" class="hidden">üë• –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</button>
                <button onclick="logout()" style="background: #aa0000;">üö™ –í—ã–π—Ç–∏</button>
            </div>

            <div class="terminal-content">
                <div id="dashboardContent">
                    <div class="ascii-block">
                        <div class="corner corner-tl">‚îå</div>
                        <div class="corner corner-tr">‚îê</div>
                        <div class="corner corner-bl">‚îî</div>
                        <div class="corner corner-br">‚îò</div>

                        <h3 style="text-align: center; margin-bottom: 25px; color: #0033a0; font-size: 22px;">
                            üìä –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                        </h3>

                        <div style="text-align: center; margin-bottom: 25px;">
                            –°—Ç–∞—Ç—É—Å: <span id="userRole" class="status status-active">Client</span>
                        </div>

                        <div id="adminStats" class="admin-stats hidden">
                            <div class="admin-stat-item">
                                <div class="admin-stat-label">–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                                <div class="admin-stat-value" id="totalUsers">0</div>
                            </div>
                            <div class="admin-stat-item">
                                <div class="admin-stat-label">–í—Å–µ–≥–æ –∫—Ä–µ–¥–∏—Ç–æ–≤</div>
                                <div class="admin-stat-value" id="totalAllLoans">0</div>
                            </div>
                            <div class="admin-stat-item">
                                <div class="admin-stat-label">–í—Å–µ–≥–æ –≤–∫–ª–∞–¥–æ–≤</div>
                                <div class="admin-stat-value" id="totalAllDeposits">0</div>
                            </div>
                            <div class="admin-stat-item">
                                <div class="admin-stat-label">–û–±—â–∞—è –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å</div>
                                <div class="admin-stat-value amount-negative" id="totalAllDebt">0 ‚ÇΩ</div>
                            </div>
                            <div class="admin-stat-item">
                                <div class="admin-stat-label">–û–±—â–∏–µ –≤–∫–ª–∞–¥—ã</div>
                                <div class="admin-stat-value amount-positive" id="totalAllDepositsBalance">0 ‚ÇΩ</div>
                            </div>
                        </div>

                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-label">–û–±—â–∞—è –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å</div>
                                <div class="stat-value amount-negative" id="totalDebt">0 ‚ÇΩ</div>
                            </div>

                            <div class="stat-card">
                                <div class="stat-label">–û–±—â–∏–µ –≤–∫–ª–∞–¥—ã</div>
                                <div class="stat-value amount-positive" id="totalDeposits">0 ‚ÇΩ</div>
                            </div>

                            <div class="stat-card">
                                <div class="stat-label">–ë–ª–∏–∂–∞–π—à–∏–π –ø–ª–∞—Ç–µ–∂</div>
                                <div class="stat-value amount-neutral" id="nextPayment">0 ‚ÇΩ</div>
                                <div class="stat-label" id="nextPaymentDate">-</div>
                            </div>
                        </div>

                        <h4 style="margin: 30px 0 15px 0; color: #0033a0; font-size: 18px;">üìÖ –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:</h4>
                        <div id="recentOperations">
                            <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –æ–ø–µ—Ä–∞—Ü–∏–π...</div>
                        </div>
                    </div>
                </div>

                <div id="loansContent" class="hidden">
                    <div class="ascii-block">
                        <div class="corner corner-tl">‚îå</div>
                        <div class="corner corner-tr">‚îê</div>
                        <div class="corner corner-bl">‚îî</div>
                        <div class="corner corner-br">‚îò</div>

                        <h3 style="text-align: center; margin-bottom: 25px; color: #0033a0; font-size: 22px;">üí≥ –ú–æ–∏ –∫—Ä–µ–¥–∏—Ç—ã</h3>

                        <button class="add-loan-btn" onclick="showNewLoan()">
                            + –û—Ñ–æ—Ä–º–∏—Ç—å –Ω–æ–≤—ã–π –∫—Ä–µ–¥–∏—Ç
                        </button>

                        <button id="viewAllLoansBtn" class="admin-btn hidden" onclick="showAllLoans()">
                            üìã –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –∫—Ä–µ–¥–∏—Ç—ã
                        </button>

                        <div class="table-container">
                            <table class="terminal-table loans-table">
                                <thead>
                                    <tr>
                                        <th>–¢–∏–ø –∫—Ä–µ–¥–∏—Ç–∞</th>
                                        <th>–°—É–º–º–∞</th>
                                        <th>–°—Ç–∞–≤–∫–∞</th>
                                        <th>–°—Ä–æ–∫</th>
                                        <th>–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç–µ–∂</th>
                                        <th>–û—Å—Ç–∞—Ç–æ–∫ –¥–æ–ª–≥–∞</th>
                                        <th>–°—Ç–∞—Ç—É—Å</th>
                                    </tr>
                                </thead>
                                <tbody id="loansTableBody">
                                    <tr>
                                        <td colspan="7" style="text-align: center; padding: 40px;">
                                            <div class="loading">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∫—Ä–µ–¥–∏—Ç–æ–≤</div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="summary">
                            <strong>–í—Å–µ–≥–æ –∫—Ä–µ–¥–∏—Ç–æ–≤:</strong> <span id="loansCount">0</span> |
                            <strong>–û–±—â–∞—è –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å:</strong> <span id="totalLoansDebt">0,00 ‚ÇΩ</span>
                        </div>
                    </div>
                </div>

                <div id="allLoansContent" class="hidden">
                    <div class="ascii-block">
                        <div class="corner corner-tl">‚îå</div>
                        <div class="corner corner-tr">‚îê</div>
                        <div class="corner corner-bl">‚îî</div>
                        <div class="corner corner-br">‚îò</div>

                        <h3 style="text-align: center; margin-bottom: 25px; color: #0033a0; font-size: 22px;">üìã –í—Å–µ –∫—Ä–µ–¥–∏—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>

                        <button class="add-loan-btn" onclick="showMyLoans()">
                            ‚Üê –ù–∞–∑–∞–¥ –∫ –º–æ–∏–º –∫—Ä–µ–¥–∏—Ç–∞–º
                        </button>

                        <div class="table-container">
                            <table class="terminal-table loans-table">
                                <thead>
                                    <tr>
                                        <th>–¢–∏–ø –∫—Ä–µ–¥–∏—Ç–∞</th>
                                        <th>–°—É–º–º–∞</th>
                                        <th>–°—Ç–∞–≤–∫–∞</th>
                                        <th>–°—Ä–æ–∫</th>
                                        <th>–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç–µ–∂</th>
                                        <th>–û—Å—Ç–∞—Ç–æ–∫ –¥–æ–ª–≥–∞</th>
                                        <th>–°—Ç–∞—Ç—É—Å</th>
                                        <th>–í–ª–∞–¥–µ–ª–µ—Ü</th>
                                    </tr>
                                </thead>
                                <tbody id="allLoansTableBody">
                                    <tr>
                                        <td colspan="8" style="text-align: center; padding: 40px;">
                                            <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –∫—Ä–µ–¥–∏—Ç–æ–≤...</div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="summary">
                            <strong>–í—Å–µ–≥–æ –∫—Ä–µ–¥–∏—Ç–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–µ:</strong> <span id="allLoansCount">0</span> |
                            <strong>–û–±—â–∞—è –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å:</strong> <span id="allLoansDebt">0,00 ‚ÇΩ</span>
                        </div>
                    </div>
                </div>

                <div id="depositsContent" class="hidden">
                    <div class="ascii-block">
                        <div class="corner corner-tl">‚îå</div>
                        <div class="corner corner-tr">‚îê</div>
                        <div class="corner corner-bl">‚îî</div>
                        <div class="corner corner-br">‚îò</div>

                        <h3 style="text-align: center; margin-bottom: 25px; color: #0033a0; font-size: 22px;">üè¶ –ú–æ–∏ –≤–∫–ª–∞–¥—ã</h3>

                        <button class="add-loan-btn" onclick="showNewDeposit()">
                            + –û—Ç–∫—Ä—ã—Ç—å –Ω–æ–≤—ã–π –≤–∫–ª–∞–¥
                        </button>

                        <button id="viewAllDepositsBtn" class="admin-btn hidden" onclick="showAllDeposits()">
                            üìä –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –≤–∫–ª–∞–¥—ã
                        </button>

                        <div class="table-container">
                            <table class="terminal-table deposits-table">
                                <thead>
                                    <tr>
                                        <th>–¢–∏–ø –≤–∫–ª–∞–¥–∞</th>
                                        <th>–°—É–º–º–∞</th>
                                        <th>–°—Ç–∞–≤–∫–∞</th>
                                        <th>–î–∞—Ç–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è</th>
                                        <th>–¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å</th>
                                        <th>–°—Ç–∞—Ç—É—Å</th>
                                    </tr>
                                </thead>
                                <tbody id="depositsTableBody">
                                    <tr>
                                        <td colspan="6" style="text-align: center; padding: 40px;">
                                            <div class="loading">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –≤–∫–ª–∞–¥–æ–≤</div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="summary">
                            <strong>–í—Å–µ–≥–æ –≤–∫–ª–∞–¥–æ–≤:</strong> <span id="depositsCount">0</span> |
                            <strong>–û–±—â–∏–π –±–∞–ª–∞–Ω—Å:</strong> <span id="totalDepositsBalance">0 ‚ÇΩ</span>
                        </div>
                    </div>
                </div>

                <div id="allDepositsContent" class="hidden">
                    <div class="ascii-block">
                        <div class="corner corner-tl">‚îå</div>
                        <div class="corner corner-tr">‚îê</div>
                        <div class="corner corner-bl">‚îî</div>
                        <div class="corner corner-br">‚îò</div>

                        <h3 style="text-align: center; margin-bottom: 25px; color: #0033a0; font-size: 22px;">üìä –í—Å–µ –≤–∫–ª–∞–¥—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>

                        <button class="add-loan-btn" onclick="showMyDeposits()">
                            ‚Üê –ù–∞–∑–∞–¥ –∫ –º–æ–∏–º –≤–∫–ª–∞–¥–∞–º
                        </button>

                        <div class="table-container">
                            <table class="terminal-table deposits-table">
                                <thead>
                                    <tr>
                                        <th>–¢–∏–ø –≤–∫–ª–∞–¥–∞</th>
                                        <th>–°—É–º–º–∞</th>
                                        <th>–°—Ç–∞–≤–∫–∞</th>
                                        <th>–î–∞—Ç–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è</th>
                                        <th>–¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å</th>
                                        <th>–°—Ç–∞—Ç—É—Å</th>
                                        <th>–í–ª–∞–¥–µ–ª–µ—Ü</th>
                                    </tr>
                                </thead>
                                <tbody id="allDepositsTableBody">
                                    <tr>
                                        <td colspan="7" style="text-align: center; padding: 40px;">
                                            <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –≤–∫–ª–∞–¥–æ–≤...</div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="summary">
                            <strong>–í—Å–µ–≥–æ –≤–∫–ª–∞–¥–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–µ:</strong> <span id="allDepositsCount">0</span> |
                            <strong>–û–±—â–∏–π –±–∞–ª–∞–Ω—Å:</strong> <span id="allDepositsBalance">0,00 ‚ÇΩ</span>
                        </div>
                    </div>
                </div>

                <div id="allUsersContent" class="hidden">
                    <div class="ascii-block">
                        <div class="corner corner-tl">‚îå</div>
                        <div class="corner corner-tr">‚îê</div>
                        <div class="corner corner-bl">‚îî</div>
                        <div class="corner corner-br">‚îò</div>

                        <h3 style="text-align: center; margin-bottom: 25px; color: #0033a0; font-size: 22px;">üë• –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã</h3>

                        <div class="table-container">
                            <table class="terminal-table users-table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>–§–ò–û</th>
                                        <th>–õ–æ–≥–∏–Ω</th>
                                        <th>–†–æ–ª—å</th>
                                        <th>–ö—Ä–µ–¥–∏—Ç–æ–≤</th>
                                        <th>–í–∫–ª–∞–¥–æ–≤</th>
                                    </tr>
                                </thead>
                                <tbody id="allUsersTableBody">
                                    <tr>
                                        <td colspan="6" style="text-align: center; padding: 40px;">
                                            <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...</div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="summary">
                            <strong>–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:</strong> <span id="totalUsersCount">0</span> |
                            <strong>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤:</strong> <span id="adminUsersCount">0</span> |
                            <strong>–ö–ª–∏–µ–Ω—Ç–æ–≤:</strong> <span id="clientUsersCount">0</span>
                        </div>
                    </div>
                </div>

                <div id="newLoanContent" class="hidden">
                    <div class="ascii-block">
                        <div class="corner corner-tl">‚îå</div>
                        <div class="corner corner-tr">‚îê</div>
                        <div class="corner corner-bl">‚îî</div>
                        <div class="corner corner-br">‚îò</div>

                        <h3 style="text-align: center; margin-bottom: 20px; color: #0033a0;">üìù –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∫—Ä–µ–¥–∏—Ç–∞</h3>

                        <div class="form-group">
                            <label>–¢–∏–ø –∫—Ä–µ–¥–∏—Ç–∞:</label>
                            <select id="loanType" class="terminal-input">
                                <option value="–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å—Å–∫–∏–π">–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å—Å–∫–∏–π</option>
                                <option value="–ò–ø–æ—Ç–µ–∫–∞">–ò–ø–æ—Ç–µ–∫–∞</option>
                                <option value="–ê–≤—Ç–æ–∫—Ä–µ–¥–∏—Ç">–ê–≤—Ç–æ–∫—Ä–µ–¥–∏—Ç</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>–°—É–º–º–∞ –∫—Ä–µ–¥–∏—Ç–∞ (—Ä—É–±.):</label>
                            <input type="number" id="loanAmount" class="terminal-input" placeholder="100000" min="1000" step="1000">
                        </div>

                        <div class="form-group">
                            <label>–ü—Ä–æ—Ü–µ–Ω—Ç–Ω–∞—è —Å—Ç–∞–≤–∫–∞ (% –≥–æ–¥–æ–≤—ã—Ö):</label>
                            <input type="number" id="loanRate" class="terminal-input" placeholder="12.5" step="0.1" min="1" max="30">
                        </div>

                        <div class="form-group">
                            <label>–°—Ä–æ–∫ (–º–µ—Å—è—Ü–µ–≤):</label>
                            <input type="number" id="loanTerm" class="terminal-input" placeholder="36" min="1" max="360">
                        </div>

                        <button class="terminal-btn" onclick="createLoan()" id="createLoanBtn">
                            –û—Ñ–æ—Ä–º–∏—Ç—å –∫—Ä–µ–¥–∏—Ç
                        </button>

                        <div id="loanMessage" class="terminal-message"></div>

                        <div id="loanPreview" class="ascii-block" style="margin-top: 20px; display: none;">
                            <h4 style="color: #0033a0;">üìä –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç:</h4>
                            <div>–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç–µ–∂: <span id="previewMonthlyPayment" class="amount-negative">0 ‚ÇΩ</span></div>
                            <div>–û–±—â–∞—è —Å—É–º–º–∞ –≤—ã–ø–ª–∞—Ç: <span id="previewTotalPayment" class="amount-negative">0 ‚ÇΩ</span></div>
                            <div>–ü–µ—Ä–µ–ø–ª–∞—Ç–∞: <span id="previewOverpayment" class="amount-negative">0 ‚ÇΩ</span></div>
                        </div>
                    </div>
                </div>

                <div id="newDepositContent" class="hidden">
                    <div class="ascii-block">
                        <div class="corner corner-tl">‚îå</div>
                        <div class="corner corner-tr">‚îê</div>
                        <div class="corner corner-bl">‚îî</div>
                        <div class="corner corner-br">‚îò</div>

                        <h3 style="text-align: center; margin-bottom: 20px; color: #0033a0;">üí∞ –û—Ç–∫—Ä—ã—Ç–∏–µ –Ω–æ–≤–æ–≥–æ –≤–∫–ª–∞–¥–∞</h3>

                        <div class="form-group">
                            <label>–¢–∏–ø –≤–∫–ª–∞–¥–∞:</label>
                            <select id="depositType" class="terminal-input">
                                <option value="–°–±–µ—Ä–µ–≥–∞—Ç–µ–ª—å–Ω—ã–π">–°–±–µ—Ä–µ–≥–∞—Ç–µ–ª—å–Ω—ã–π</option>
                                <option value="–ù–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω—ã–π">–ù–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω—ã–π</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>–°—É–º–º–∞ –≤–∫–ª–∞–¥–∞ (—Ä—É–±.):</label>
                            <input type="number" id="depositAmount" class="terminal-input" placeholder="50000" min="1000" step="1000">
                        </div>

                        <div class="form-group">
                            <label>–ü—Ä–æ—Ü–µ–Ω—Ç–Ω–∞—è —Å—Ç–∞–≤–∫–∞ (% –≥–æ–¥–æ–≤—ã—Ö):</label>
                            <input type="number" id="depositRate" class="terminal-input" placeholder="7.5" step="0.1" min="0.1" max="15">
                        </div>

                        <button class="terminal-btn" onclick="createDeposit()" id="createDepositBtn">
                            –û—Ç–∫—Ä—ã—Ç—å –≤–∫–ª–∞–¥
                        </button>

                        <div id="depositMessage" class="terminal-message"></div>

                        <div id="depositPreview" class="ascii-block" style="margin-top: 20px; display: none;">
                            <h4 style="color: #0033a0;">üìä –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç:</h4>
                            <div>–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –¥–æ—Ö–æ–¥: <span id="previewMonthlyIncome" class="amount-positive">0 ‚ÇΩ</span></div>
                            <div>–û–±—â–∏–π –¥–æ—Ö–æ–¥ –∑–∞ –≥–æ–¥: <span id="previewTotalIncome" class="amount-positive">0 ‚ÇΩ</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="terminal-footer">
                ¬© 2024 –ü–ê–û "–°–±–µ—Ä–±–∞–Ω–∫". –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã. | –ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–π —Ü–µ–Ω—Ç—Ä: 8-800-555-55-50
            </div>
        </div>
    </div>

    <script>
        let currentUser = null;
        let userLoans = [];
        let userDeposits = [];
        let userIdCounter = 1;
        let loanIdCounter = 1;
        let depositIdCounter = 1;

        function showMessage(elementId, text, type) {
            const element = document.getElementById(elementId);
            element.textContent = text;
            element.className = `terminal-message message-${type}`;
            element.style.display = 'block';

            setTimeout(() => {
                element.style.display = 'none';
            }, 5000);
        }

        function formatCurrency(amount) {
            if (amount === null || amount === undefined) return '0,00 ‚ÇΩ';
            return new Intl.NumberFormat('ru-RU', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(amount) + ' ‚ÇΩ';
        }

        function formatDate(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleDateString('ru-RU');
        }

        function hideAllSections() {
            const sections = [
                'dashboardContent',
                'loansContent',
                'allLoansContent',
                'newLoanContent',
                'depositsContent',
                'allDepositsContent',
                'newDepositContent',
                'allUsersContent'
            ];

            sections.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.classList.add('hidden');
                }
            });

            const menuButtons = [
                'dashboardBtn', 'loansBtn', 'allLoansBtn', 'newLoanBtn',
                'depositsBtn', 'allDepositsBtn', 'newDepositBtn', 'allUsersBtn'
            ];
            menuButtons.forEach(id => {
                const btn = document.getElementById(id);
                if (btn && !btn.textContent.includes('–í—ã–π—Ç–∏')) {
                    btn.style.background = '#0033a0';
                }
            });
        }

        function updateUIForRole() {
            const isAdmin = currentUser && currentUser.role === 'Admin';

            document.getElementById('allLoansBtn').classList.toggle('hidden', !isAdmin);
            document.getElementById('allDepositsBtn').classList.toggle('hidden', !isAdmin);
            document.getElementById('allUsersBtn').classList.toggle('hidden', !isAdmin);

            document.getElementById('viewAllLoansBtn').classList.toggle('hidden', !isAdmin);
            document.getElementById('viewAllDepositsBtn').classList.toggle('hidden', !isAdmin);

            document.getElementById('adminStats').classList.toggle('hidden', !isAdmin);

            const statusElement = document.getElementById('userRole');
            if (statusElement) {
                if (isAdmin) {
                    statusElement.textContent = 'Admin';
                    statusElement.className = 'status status-admin';
                } else {
                    statusElement.textContent = 'Client';
                    statusElement.className = 'status status-active';
                }
            }
        }

        function getAllLoansFromStorage() {
            // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            const allUsers = JSON.parse(localStorage.getItem('bank_users') || '[]');
            let allLoans = [];

            const adminLoans = JSON.parse(localStorage.getItem(`loans_1`) || '[]');
            allLoans = allLoans.concat(adminLoans.map(loan => ({
                ...loan,
                ownerId: 1,
                ownerName: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä'
            })));

            allUsers.forEach(user => {
                const userLoans = JSON.parse(localStorage.getItem(`loans_${user.id}`) || '[]');
                allLoans = allLoans.concat(userLoans.map(loan => ({
                    ...loan,
                    ownerId: user.id,
                    ownerName: user.fullName
                })));
            });

            return allLoans;
        }

        function getAllDepositsFromStorage() {
            // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            const allUsers = JSON.parse(localStorage.getItem('bank_users') || '[]');
            let allDeposits = [];

            const adminDeposits = JSON.parse(localStorage.getItem(`deposits_1`) || '[]');
            allDeposits = allDeposits.concat(adminDeposits.map(deposit => ({
                ...deposit,
                ownerId: 1,
                ownerName: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä'
            })));

            allUsers.forEach(user => {
                const userDeposits = JSON.parse(localStorage.getItem(`deposits_${user.id}`) || '[]');
                allDeposits = allDeposits.concat(userDeposits.map(deposit => ({
                    ...deposit,
                    ownerId: user.id,
                    ownerName: user.fullName
                })));
            });

            return allDeposits;
        }

        function getUserLoans() {
            if (!currentUser) return [];

            if (currentUser.role === 'Admin') {
                return getAllLoansFromStorage();
            }

            return JSON.parse(localStorage.getItem(`loans_${currentUser.id}`) || '[]');
        }

        function getUserDeposits() {
            if (!currentUser) return [];

            if (currentUser.role === 'Admin') {
                return getAllDepositsFromStorage();
            }

            return JSON.parse(localStorage.getItem(`deposits_${currentUser.id}`) || '[]');
        }

        function saveLoan(loanData) {
            const loanWithOwner = {
                ...loanData,
                ownerId: currentUser.id,
                ownerName: currentUser.fullName || currentUser.username
            };

            userLoans.push(loanWithOwner);
            localStorage.setItem(`loans_${currentUser.id}`, JSON.stringify(userLoans));

            if (currentUser.role !== 'Admin') {
                const allLoans = JSON.parse(localStorage.getItem('all_loans') || '[]');
                allLoans.push(loanWithOwner);
                localStorage.setItem('all_loans', JSON.stringify(allLoans));
            }
        }

        function saveDeposit(depositData) {
            const depositWithOwner = {
                ...depositData,
                ownerId: currentUser.id,
                ownerName: currentUser.fullName || currentUser.username
            };

            userDeposits.push(depositWithOwner);
            localStorage.setItem(`deposits_${currentUser.id}`, JSON.stringify(userDeposits));

            if (currentUser.role !== 'Admin') {
                const allDeposits = JSON.parse(localStorage.getItem('all_deposits') || '[]');
                allDeposits.push(depositWithOwner);
                localStorage.setItem('all_deposits', JSON.stringify(allDeposits));
            }
        }

        function showLogin() {
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('registerForm').classList.add('hidden');
            const loginBtn = document.getElementById('loginTabBtn');
            const registerBtn = document.getElementById('registerTabBtn');
            if (loginBtn) loginBtn.style.background = '#002080';
            if (registerBtn) registerBtn.style.background = '#0033a0';
        }

        function showRegister() {
            document.getElementById('registerForm').classList.remove('hidden');
            document.getElementById('loginForm').classList.add('hidden');
            const loginBtn = document.getElementById('loginTabBtn');
            const registerBtn = document.getElementById('registerTabBtn');
            if (loginBtn) loginBtn.style.background = '#0033a0';
            if (registerBtn) registerBtn.style.background = '#002080';
        }

        function login() {
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value;

            if (!username || !password) {
                showMessage('loginMessage', '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', 'error');
                return;
            }

            const loginBtn = document.getElementById('loginBtn');
            const originalText = loginBtn.textContent;
            loginBtn.textContent = '–í—Ö–æ–¥...';
            loginBtn.disabled = true;

            setTimeout(() => {
                if (username === 'admin' && password === 'admin123') {
                    currentUser = {
                        id: 1,
                        username: 'admin',
                        fullName: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä',
                        role: 'Admin'
                    };

                    localStorage.setItem('bank_user', JSON.stringify(currentUser));

                    document.getElementById('authSection').classList.add('hidden');
                    document.getElementById('mainApp').classList.remove('hidden');

                    document.getElementById('userName').textContent = currentUser.fullName;
                    document.getElementById('userWelcome').textContent = `–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${currentUser.fullName}!`;

                    userLoans = getUserLoans();
                    userDeposits = getUserDeposits();

                    updateUIForRole();

                    showMessage('loginMessage', '‚úÖ –í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!', 'success');
                    showDashboard();

                } else {
                    const users = JSON.parse(localStorage.getItem('bank_users') || '[]');
                    const user = users.find(u => u.username === username && u.password === password);

                    if (user) {
                        currentUser = {
                            id: user.id,
                            username: user.username,
                            fullName: user.fullName,
                            role: 'Client'
                        };

                        localStorage.setItem('bank_user', JSON.stringify(currentUser));

                        document.getElementById('authSection').classList.add('hidden');
                        document.getElementById('mainApp').classList.remove('hidden');

                        document.getElementById('userName').textContent = currentUser.fullName;
                        document.getElementById('userWelcome').textContent = `–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${currentUser.fullName}!`;

                        userLoans = getUserLoans();
                        userDeposits = getUserDeposits();

                        updateUIForRole();

                        showMessage('loginMessage', '‚úÖ –í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!', 'success');
                        showDashboard();
                    } else {
                        showMessage('loginMessage', '‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å (401)', 'error');
                    }
                }

                loginBtn.textContent = originalText;
                loginBtn.disabled = false;
            }, 800);
        }

        function register() {
            const fullName = document.getElementById('regFullName').value.trim();
            const username = document.getElementById('regUsername').value.trim();
            const password = document.getElementById('regPassword').value;

            if (!fullName || !username || !password) {
                showMessage('registerMessage', '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', 'error');
                return;
            }

            if (password.length < 6) {
                showMessage('registerMessage', '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤', 'error');
                return;
            }

            const regBtn = document.getElementById('registerBtn');
            const originalText = regBtn.textContent;
            regBtn.textContent = '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è...';
            regBtn.disabled = true;

            setTimeout(() => {
                const users = JSON.parse(localStorage.getItem('bank_users') || '[]');

                if (users.some(u => u.username === username)) {
                    showMessage('registerMessage', '‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º –ª–æ–≥–∏–Ω–æ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç', 'error');
                    regBtn.textContent = originalText;
                    regBtn.disabled = false;
                    return;
                }

                const newUser = {
                    id: userIdCounter++,
                    username: username,
                    password: password,
                    fullName: fullName,
                    role: 'Client'
                };

                users.push(newUser);
                localStorage.setItem('bank_users', JSON.stringify(users));

                localStorage.setItem(`loans_${newUser.id}`, JSON.stringify([]));
                localStorage.setItem(`deposits_${newUser.id}`, JSON.stringify([]));

                showMessage('registerMessage', '‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤—Ö–æ–¥...', 'success');

                setTimeout(() => {
                    document.getElementById('loginUsername').value = username;
                    document.getElementById('loginPassword').value = password;
                    login();
                }, 1500);

                regBtn.textContent = originalText;
                regBtn.disabled = false;
            }, 800);
        }

        function logout() {
            currentUser = null;
            userLoans = [];
            userDeposits = [];
            localStorage.removeItem('bank_user');

            document.getElementById('mainApp').classList.add('hidden');
            document.getElementById('authSection').classList.remove('hidden');

            showLogin();
        }

        function showDashboard() {
            hideAllSections();
            const dashboardContent = document.getElementById('dashboardContent');
            if (dashboardContent) {
                dashboardContent.classList.remove('hidden');
            }
            const dashboardBtn = document.getElementById('dashboardBtn');
            if (dashboardBtn) {
                dashboardBtn.style.background = '#002080';
            }
            loadDashboardData();
        }

        function loadDashboardData() {
            if (!currentUser) return;

            userLoans = getUserLoans();
            userDeposits = getUserDeposits();

            let totalDebt = 0;
            let totalDeposits = 0;
            let nextPayment = 0;
            let nextPaymentDate = '15.02.2024';
            let recentOperations = [];

            userLoans.forEach(loan => {
                totalDebt += (loan.remainingDebt || loan.amount || 0);

                recentOperations.push({
                    date: loan.startDate || new Date().toISOString(),
                    type: 'credit',
                    description: `–û—Ñ–æ—Ä–º–ª–µ–Ω ${loan.loanType || '–∫—Ä–µ–¥–∏—Ç'}`,
                    amount: loan.amount,
                    details: `${loan.interestRate || 0}% –Ω–∞ ${loan.termMonths || 0} –º–µ—Å.`,
                    owner: loan.ownerName || currentUser.fullName
                });

                if (loan.status === 'Active' && loan.monthlyPayment) {
                    nextPayment = loan.monthlyPayment;
                    nextPaymentDate = loan.nextPaymentDate || '15.02.2024';
                }
            });

            userDeposits.forEach(deposit => {
                totalDeposits += (deposit.currentBalance || deposit.amount || 0);

                recentOperations.push({
                    date: deposit.openDate || new Date().toISOString(),
                    type: 'deposit',
                    description: `–û—Ç–∫—Ä—ã—Ç ${deposit.depositType || '–≤–∫–ª–∞–¥'}`,
                    amount: deposit.amount,
                    details: `${deposit.interestRate || 0}% –≥–æ–¥–æ–≤—ã—Ö`,
                    owner: deposit.ownerName || currentUser.fullName
                });
            });

            recentOperations.sort((a, b) => new Date(b.date) - new Date(a.date));

            document.getElementById('totalDebt').textContent = formatCurrency(totalDebt);
            document.getElementById('totalDeposits').textContent = formatCurrency(totalDeposits);
            document.getElementById('nextPayment').textContent = formatCurrency(nextPayment);
            document.getElementById('nextPaymentDate').textContent = nextPaymentDate;

            updateRecentOperations(recentOperations.slice(0, 5));

            if (currentUser.role === 'Admin') {
                loadAdminDashboardStats();
            }
        }

        function loadAdminDashboardStats() {
            const allUsers = JSON.parse(localStorage.getItem('bank_users') || '[]');

            let totalUsers = allUsers.length + 1; // +1 –¥–ª—è –∞–¥–º–∏–Ω–∞
            let totalAllLoans = userLoans.length;
            let totalAllDeposits = userDeposits.length;
            let totalAllDebt = 0;
            let totalAllDepositsBalance = 0;

            userLoans.forEach(loan => {
                totalAllDebt += (loan.remainingDebt || loan.amount || 0);
            });

            userDeposits.forEach(deposit => {
                totalAllDepositsBalance += (deposit.currentBalance || deposit.amount || 0);
            });

            document.getElementById('totalUsers').textContent = totalUsers;
            document.getElementById('totalAllLoans').textContent = totalAllLoans;
            document.getElementById('totalAllDeposits').textContent = totalAllDeposits;
            document.getElementById('totalAllDebt').textContent = formatCurrency(totalAllDebt);
            document.getElementById('totalAllDepositsBalance').textContent = formatCurrency(totalAllDepositsBalance);
        }

        function updateRecentOperations(operations) {
            const container = document.getElementById('recentOperations');
            if (!container) return;

            if (!operations || operations.length === 0) {
                container.innerHTML = '<div class="loading">–ù–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π</div>';
                return;
            }

            let html = '';
            operations.forEach(op => {
                const date = formatDate(op.date);
                const icon = op.type === 'credit' ? 'üí≥' : 'üè¶';
                const amountClass = op.type === 'credit' ? 'amount-negative' : 'amount-positive';

                const ownerInfo = currentUser.role === 'Admin' && op.owner !== currentUser.fullName
                    ? `<div style="font-size: 12px; color: #666;">–í–ª–∞–¥–µ–ª–µ—Ü: ${op.owner}</div>`
                    : '';

                html += `
                        <div class="operation">
                            <div class="operation-date">${icon} ${date} - ${op.description}</div>
                            <div class="operation-amount ${amountClass}">${formatCurrency(op.amount)}</div>
                            <div style="font-size: 14px; color: #666;">${op.details}</div>
                            ${ownerInfo}
                        </div>
                    `;
            });

            container.innerHTML = html;
        }

        function showMyLoans() {
            hideAllSections();
            const loansContent = document.getElementById('loansContent');
            if (loansContent) {
                loansContent.classList.remove('hidden');
            }
            const loansBtn = document.getElementById('loansBtn');
            if (loansBtn) {
                loansBtn.style.background = '#002080';
            }
            loadLoans();
        }

        function showAllLoans() {
            hideAllSections();
            const allLoansContent = document.getElementById('allLoansContent');
            if (allLoansContent) {
                allLoansContent.classList.remove('hidden');
            }
            const allLoansBtn = document.getElementById('allLoansBtn');
            if (allLoansBtn) {
                allLoansBtn.style.background = '#002080';
            }
            loadAllLoans();
        }

        function loadLoans() {
            if (!currentUser) return;

            userLoans = getUserLoans();
            updateLoansTable(userLoans, 'loansTableBody');
        }

        function loadAllLoans() {
            loadLoans();

            const totalDebt = userLoans.reduce((sum, loan) => sum + (loan.remainingDebt || loan.amount || 0), 0);
            document.getElementById('allLoansCount').textContent = userLoans.length;
            document.getElementById('allLoansDebt').textContent = formatCurrency(totalDebt);

            updateAllLoansTable(userLoans, totalDebt);
        }

        function updateLoansTable(loans, tableBodyId = 'loansTableBody') {
            const tbody = document.getElementById(tableBodyId);
            const isAdmin = currentUser.role === 'Admin';
            const isAllLoansTable = tableBodyId === 'allLoansTableBody';

            if (!loans || loans.length === 0) {
                const colSpan = isAllLoansTable ? 8 : 7;
                tbody.innerHTML = `
                        <tr>
                            <td colspan="${colSpan}" style="text-align: center; padding: 40px;">
                                ${isAllLoansTable ? '–í —Å–∏—Å—Ç–µ–º–µ –ø–æ–∫–∞ –Ω–µ—Ç –∫—Ä–µ–¥–∏—Ç–æ–≤' : '–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∫—Ä–µ–¥–∏—Ç–æ–≤'}
                            </td>
                        </tr>
                    `;

                if (!isAllLoansTable) {
                    document.getElementById('loansCount').textContent = '0';
                    document.getElementById('totalLoansDebt').textContent = formatCurrency(0);
                }
                return;
            }

            let totalDebt = 0;
            let html = '';

            loans.forEach(loan => {
                const remainingDebt = loan.remainingDebt || loan.amount || 0;
                totalDebt += remainingDebt;

                const statusClass = loan.status === 'Active' ? 'status-active' :
                    loan.status === 'Paid' ? 'status-paid' : 'status-overdue';

                if (isAllLoansTable) {
                    html += `
                            <tr>
                                <td>${loan.loanType || '–ù–µ —É–∫–∞–∑–∞–Ω'}</td>
                                <td>${formatCurrency(loan.amount)}</td>
                                <td>${loan.interestRate || 0}%</td>
                                <td>${loan.termMonths || 0} –º–µ—Å.</td>
                                <td>${formatCurrency(loan.monthlyPayment || 0)}</td>
                                <td>${formatCurrency(remainingDebt)}</td>
                                <td><span class="status ${statusClass}">${loan.status || 'Active'}</span></td>
                                <td>${loan.ownerName || '–ù–µ —É–∫–∞–∑–∞–Ω'}</td>
                            </tr>
                        `;
                } else {
                    html += `
                            <tr>
                                <td>${loan.loanType || '–ù–µ —É–∫–∞–∑–∞–Ω'}</td>
                                <td>${formatCurrency(loan.amount)}</td>
                                <td>${loan.interestRate || 0}%</td>
                                <td>${loan.termMonths || 0} –º–µ—Å.</td>
                                <td>${formatCurrency(loan.monthlyPayment || 0)}</td>
                                <td>${formatCurrency(remainingDebt)}</td>
                                <td><span class="status ${statusClass}">${loan.status || 'Active'}</span></td>
                            </tr>
                        `;
                }
            });

            tbody.innerHTML = html;

            if (!isAllLoansTable) {
                document.getElementById('loansCount').textContent = loans.length;
                document.getElementById('totalLoansDebt').textContent = formatCurrency(totalDebt);
            }
        }

        function updateAllLoansTable(allLoans, totalDebt) {
            updateLoansTable(allLoans, 'allLoansTableBody');
        }

        function showNewLoan() {
            hideAllSections();
            const newLoanContent = document.getElementById('newLoanContent');
            if (newLoanContent) {
                newLoanContent.classList.remove('hidden');
            }
            const newLoanBtn = document.getElementById('newLoanBtn');
            if (newLoanBtn) {
                newLoanBtn.style.background = '#002080';
            }

            document.getElementById('loanAmount').value = '';
            document.getElementById('loanRate').value = '';
            document.getElementById('loanTerm').value = '';
            document.getElementById('loanMessage').style.display = 'none';
            document.getElementById('loanPreview').style.display = 'none';
        }

        function createLoan() {
            const loanType = document.getElementById('loanType').value;
            const amount = parseFloat(document.getElementById('loanAmount').value);
            const rate = parseFloat(document.getElementById('loanRate').value);
            const term = parseInt(document.getElementById('loanTerm').value);

            if (!amount || amount <= 0) {
                showMessage('loanMessage', '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É –∫—Ä–µ–¥–∏—Ç–∞', 'error');
                return;
            }

            if (!rate || rate <= 0) {
                showMessage('loanMessage', '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –ø—Ä–æ—Ü–µ–Ω—Ç–Ω—É—é —Å—Ç–∞–≤–∫—É', 'error');
                return;
            }

            if (!term || term <= 0) {
                showMessage('loanMessage', '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Å—Ä–æ–∫ –∫—Ä–µ–¥–∏—Ç–∞', 'error');
                return;
            }

            const createBtn = document.getElementById('createLoanBtn');
            const originalText = createBtn.textContent;
            createBtn.textContent = '–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ...';
            createBtn.disabled = true;

            setTimeout(() => {
                const monthlyRate = rate / 100 / 12;
                const monthlyPayment = amount * monthlyRate * Math.pow(1 + monthlyRate, term) / (Math.pow(1 + monthlyRate, term) - 1);
                const totalPayment = monthlyPayment * term;
                const overpayment = totalPayment - amount;

                const newLoan = {
                    id: loanIdCounter++,
                    loanType: loanType,
                    amount: amount,
                    interestRate: rate,
                    termMonths: term,
                    monthlyPayment: monthlyPayment,
                    remainingDebt: amount,
                    totalPayment: totalPayment,
                    overpayment: overpayment,
                    status: 'Active',
                    startDate: new Date().toISOString(),
                    nextPaymentDate: '15.02.2024'
                };

                saveLoan(newLoan);

                showMessage('loanMessage', `‚úÖ –ö—Ä–µ–¥–∏—Ç —É—Å–ø–µ—à–Ω–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω! ID: ${newLoan.id}`, 'success');

                document.getElementById('loanAmount').value = '';
                document.getElementById('loanRate').value = '';
                document.getElementById('loanTerm').value = '';

                setTimeout(() => {
                    if (currentUser.role === 'Admin') {
                        showAllLoans();
                    } else {
                        showMyLoans();
                    }
                }, 2000);

                createBtn.textContent = originalText;
                createBtn.disabled = false;
            }, 800);
        }

        function showMyDeposits() {
            hideAllSections();
            const depositsContent = document.getElementById('depositsContent');
            if (depositsContent) {
                depositsContent.classList.remove('hidden');
            }
            const depositsBtn = document.getElementById('depositsBtn');
            if (depositsBtn) {
                depositsBtn.style.background = '#002080';
            }
            loadDeposits();
        }

        function showAllDeposits() {
            hideAllSections();
            const allDepositsContent = document.getElementById('allDepositsContent');
            if (allDepositsContent) {
                allDepositsContent.classList.remove('hidden');
            }
            const allDepositsBtn = document.getElementById('allDepositsBtn');
            if (allDepositsBtn) {
                allDepositsBtn.style.background = '#002080';
            }
            loadAllDeposits();
        }

        function loadDeposits() {
            if (!currentUser) return;

            userDeposits = getUserDeposits();
            updateDepositsTable(userDeposits, 'depositsTableBody');
        }

        function loadAllDeposits() {
            loadDeposits();

            const totalBalance = userDeposits.reduce((sum, deposit) => sum + (deposit.currentBalance || deposit.amount || 0), 0);
            document.getElementById('allDepositsCount').textContent = userDeposits.length;
            document.getElementById('allDepositsBalance').textContent = formatCurrency(totalBalance);

            updateAllDepositsTable(userDeposits, totalBalance);
        }

        function updateDepositsTable(deposits, tableBodyId = 'depositsTableBody') {
            const tbody = document.getElementById(tableBodyId);
            const isAdmin = currentUser.role === 'Admin';
            const isAllDepositsTable = tableBodyId === 'allDepositsTableBody';

            if (!deposits || deposits.length === 0) {
                const colSpan = isAllDepositsTable ? 7 : 6;
                tbody.innerHTML = `
                        <tr>
                            <td colspan="${colSpan}" style="text-align: center; padding: 40px;">
                                ${isAllDepositsTable ? '–í —Å–∏—Å—Ç–µ–º–µ –ø–æ–∫–∞ –Ω–µ—Ç –≤–∫–ª–∞–¥–æ–≤' : '–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –≤–∫–ª–∞–¥–æ–≤'}
                            </td>
                        </tr>
                    `;

                if (!isAllDepositsTable) {
                    document.getElementById('depositsCount').textContent = '0';
                    document.getElementById('totalDepositsBalance').textContent = formatCurrency(0);
                }
                return;
            }

            let totalBalance = 0;
            let html = '';

            deposits.forEach(deposit => {
                const balance = deposit.currentBalance || deposit.amount || 0;
                totalBalance += balance;
                const statusClass = deposit.status === 'Active' ? 'status-active' : 'status-paid';
                const openDate = formatDate(deposit.openDate);

                if (isAllDepositsTable) {
                    html += `
                            <tr>
                                <td>${deposit.depositType || '–ù–µ —É–∫–∞–∑–∞–Ω'}</td>
                                <td>${formatCurrency(deposit.amount)}</td>
                                <td>${deposit.interestRate || 0}%</td>
                                <td>${openDate}</td>
                                <td>${formatCurrency(balance)}</td>
                                <td><span class="status ${statusClass}">${deposit.status || 'Active'}</span></td>
                                <td>${deposit.ownerName || '–ù–µ —É–∫–∞–∑–∞–Ω'}</td>
                            </tr>
                        `;
                } else {
                    html += `
                            <tr>
                                <td>${deposit.depositType || '–ù–µ —É–∫–∞–∑–∞–Ω'}</td>
                                <td>${formatCurrency(deposit.amount)}</td>
                                <td>${deposit.interestRate || 0}%</td>
                                <td>${openDate}</td>
                                <td>${formatCurrency(balance)}</td>
                                <td><span class="status ${statusClass}">${deposit.status || 'Active'}</span></td>
                            </tr>
                        `;
                }
            });

            tbody.innerHTML = html;

            if (!isAllDepositsTable) {
                document.getElementById('depositsCount').textContent = deposits.length;
                document.getElementById('totalDepositsBalance').textContent = formatCurrency(totalBalance);
            }
        }

        function updateAllDepositsTable(allDeposits, totalBalance) {
            updateDepositsTable(allDeposits, 'allDepositsTableBody');
        }

        function showNewDeposit() {
            hideAllSections();
            const newDepositContent = document.getElementById('newDepositContent');
            if (newDepositContent) {
                newDepositContent.classList.remove('hidden');
            }
            const newDepositBtn = document.getElementById('newDepositBtn');
            if (newDepositBtn) {
                newDepositBtn.style.background = '#002080';
            }

            document.getElementById('depositAmount').value = '';
            document.getElementById('depositRate').value = '';
            document.getElementById('depositMessage').style.display = 'none';
            document.getElementById('depositPreview').style.display = 'none';
        }

        function createDeposit() {
            const depositType = document.getElementById('depositType').value;
            const amount = parseFloat(document.getElementById('depositAmount').value);
            const rate = parseFloat(document.getElementById('depositRate').value);

            if (!amount || amount <= 0) {
                showMessage('depositMessage', '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É –≤–∫–ª–∞–¥–∞', 'error');
                return;
            }

            if (!rate || rate <= 0) {
                showMessage('depositMessage', '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –ø—Ä–æ—Ü–µ–Ω—Ç–Ω—É—é —Å—Ç–∞–≤–∫—É', 'error');
                return;
            }

            const createBtn = document.getElementById('createDepositBtn');
            const originalText = createBtn.textContent;
            createBtn.textContent = '–û—Ç–∫—Ä—ã—Ç–∏–µ...';
            createBtn.disabled = true;

            setTimeout(() => {
                const newDeposit = {
                    id: depositIdCounter++,
                    depositType: depositType,
                    amount: amount,
                    interestRate: rate,
                    currentBalance: amount,
                    status: 'Active',
                    openDate: new Date().toISOString()
                };

                saveDeposit(newDeposit);

                showMessage('depositMessage', `‚úÖ –í–∫–ª–∞–¥ —É—Å–ø–µ—à–Ω–æ –æ—Ç–∫—Ä—ã—Ç! ID: ${newDeposit.id}`, 'success');

                document.getElementById('depositAmount').value = '';
                document.getElementById('depositRate').value = '';

                setTimeout(() => {
                    if (currentUser.role === 'Admin') {
                        showAllDeposits();
                    } else {
                        showMyDeposits();
                    }
                }, 2000);

                createBtn.textContent = originalText;
                createBtn.disabled = false;
            }, 800);
        }

        function showAllUsers() {
            hideAllSections();
            const allUsersContent = document.getElementById('allUsersContent');
            if (allUsersContent) {
                allUsersContent.classList.remove('hidden');
            }
            const allUsersBtn = document.getElementById('allUsersBtn');
            if (allUsersBtn) {
                allUsersBtn.style.background = '#002080';
            }
            loadAllUsers();
        }

        function loadAllUsers() {
            if (!currentUser || currentUser.role !== 'Admin') return;

            const allUsers = JSON.parse(localStorage.getItem('bank_users') || '[]');

            const usersList = [{
                id: 1,
                username: 'admin',
                fullName: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä',
                role: 'Admin'
            }, ...allUsers];

            updateAllUsersTable(usersList);
        }

        function updateAllUsersTable(users) {
            const tbody = document.getElementById('allUsersTableBody');

            if (!users || users.length === 0) {
                tbody.innerHTML = `
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 40px;">
                                –í —Å–∏—Å—Ç–µ–º–µ –Ω–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                            </td>
                        </tr>
                    `;
                updateUsersSummary(0, 0, 0);
                return;
            }

            let html = '';
            let adminCount = 0;
            let clientCount = 0;

            users.forEach(user => {
                const userLoans = JSON.parse(localStorage.getItem(`loans_${user.id}`) || '[]');
                const loansCount = userLoans.length;

                const userDeposits = JSON.parse(localStorage.getItem(`deposits_${user.id}`) || '[]');
                const depositsCount = userDeposits.length;

                if (user.role === 'Admin') {
                    adminCount++;
                } else {
                    clientCount++;
                }

                html += `
                        <tr>
                            <td>${user.id}</td>
                            <td>${user.fullName || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</td>
                            <td>${user.username}</td>
                            <td><span class="status ${user.role === 'Admin' ? 'status-admin' : 'status-active'}">${user.role || 'Client'}</span></td>
                            <td>${loansCount}</td>
                            <td>${depositsCount}</td>
                        </tr>
                    `;
            });

            tbody.innerHTML = html;
            updateUsersSummary(users.length, adminCount, clientCount);
        }

        function updateUsersSummary(total, admins, clients) {
            document.getElementById('totalUsersCount').textContent = total;
            document.getElementById('adminUsersCount').textContent = admins;
            document.getElementById('clientUsersCount').textContent = clients;
        }

        document.addEventListener('DOMContentLoaded', function () {
            console.log('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è —Å –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å—é)');

            const savedUser = localStorage.getItem('bank_user');

            if (savedUser) {
                try {
                    currentUser = JSON.parse(savedUser);

                    document.getElementById('authSection').classList.add('hidden');
                    document.getElementById('mainApp').classList.remove('hidden');

                    document.getElementById('userName').textContent = currentUser.fullName || currentUser.username;
                    document.getElementById('userWelcome').textContent = `–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${currentUser.fullName || currentUser.username}!`;

                    userLoans = getUserLoans();
                    userDeposits = getUserDeposits();

                    updateUIForRole();

                    showDashboard();
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', e);
                    localStorage.removeItem('bank_user');
                    showLogin();
                }
            } else {
                showLogin();
            }

            const loansAll = JSON.parse(localStorage.getItem('all_loans') || '[]');
            loanIdCounter = loansAll.length > 0 ? Math.max(...loansAll.map(l => l.id || 0)) + 1 : 1;

            const depositsAll = JSON.parse(localStorage.getItem('all_deposits') || '[]');
            depositIdCounter = depositsAll.length > 0 ? Math.max(...depositsAll.map(d => d.id || 0)) + 1 : 1;

            const usersAll = JSON.parse(localStorage.getItem('bank_users') || '[]');
            userIdCounter = usersAll.length > 0 ? Math.max(...usersAll.map(u => u.id || 0)) + 1 : 1;
        });

        document.getElementById('loanAmount')?.addEventListener('input', calculateLoanPreview);
        document.getElementById('loanRate')?.addEventListener('input', calculateLoanPreview);
        document.getElementById('loanTerm')?.addEventListener('input', calculateLoanPreview);

        document.getElementById('depositAmount')?.addEventListener('input', calculateDepositPreview);
        document.getElementById('depositRate')?.addEventListener('input', calculateDepositPreview);

        function calculateLoanPreview() {
            const amount = parseFloat(document.getElementById('loanAmount').value) || 0;
            const rate = parseFloat(document.getElementById('loanRate').value) || 0;
            const term = parseInt(document.getElementById('loanTerm').value) || 0;

            if (amount > 0 && rate > 0 && term > 0) {
                const monthlyRate = rate / 100 / 12;
                const monthlyPayment = amount * monthlyRate * Math.pow(1 + monthlyRate, term) / (Math.pow(1 + monthlyRate, term) - 1);
                const totalPayment = monthlyPayment * term;
                const overpayment = totalPayment - amount;

                document.getElementById('previewMonthlyPayment').textContent = formatCurrency(monthlyPayment);
                document.getElementById('previewTotalPayment').textContent = formatCurrency(totalPayment);
                document.getElementById('previewOverpayment').textContent = formatCurrency(overpayment);
                document.getElementById('loanPreview').style.display = 'block';
            } else {
                document.getElementById('loanPreview').style.display = 'none';
            }
        }

        function calculateDepositPreview() {
            const amount = parseFloat(document.getElementById('depositAmount').value) || 0;
            const rate = parseFloat(document.getElementById('depositRate').value) || 0;

            if (amount > 0 && rate > 0) {
                const monthlyIncome = amount * (rate / 100 / 12);
                const yearlyIncome = amount * (rate / 100);

                document.getElementById('previewMonthlyIncome').textContent = formatCurrency(monthlyIncome);
                document.getElementById('previewTotalIncome').textContent = formatCurrency(yearlyIncome);
                document.getElementById('depositPreview').style.display = 'block';
            } else {
                document.getElementById('depositPreview').style.display = 'none';
            }
        }
    </script>
